## Базова інформація
SLZB-OS - єдина операційна система для всіх пристроїв SLZB-06/06p7/06p10/06M та майбутніх пристроїв цієї лінійки.
<br>SLZB-OS використовує Berry Script Language [Official page](https://berry-lang.github.io/) Документація: [berry’s documentation](https://berry.readthedocs.io/en/latest/) and [Berry in 20 minutes or less](https://berry.readthedocs.io/en/latest/source/en/Berry-in-20-minutes.html)

## Особливості Berry на SLZB-OS
- Наразі ви можете мати до 3 запущених скриптів одночасно (може бути збільшено в майбутньому)
- Кожен запущений скрипт працює в окремій задачі і має максимальний стек 5120 слів (може бути збільшено в майбутньому)
- Модуль ```SLZB``` завантажується автоматично для кожного скрипта але всі інші модулі мають бути підключені через ```import``` перед їх використанням
- Скрипт повинен містити метадату щоб система могляа його коректно завантажити. Прочитайте більше про це в секції "Метадата"

## Метадата
Метадата це системна інформація на основі якої SLZB-OS буде визначати як завантажувати скрипт. Та його додаткові параметри
<br>Матадата поділяється на обов'язкову і опціональну

### Обов'язкова метадата
```#META {"start":1}``` так виглядає базова обов'язкова метадата. Обов'язкова метадата завжди повинна вочинатись із коментаря ```#META ```(пробіл після #META обов'язковий!) та закінчуватись символом нового рядка (```\n```)
<br>Якщо скрипт не містить обов'язкової метадати то його не буде завантажено при старті системи але ви все ще можете запустити його в ручну.
<br>Параметер ```start``` визначає режим запуску скрипта. Підтримувані значення:
- 0 - скрипт запускається в ручному режимі
- 1 - скрипт запускається при старті системи (автоматично)

### Опціональна метадата
Наразі в розробці

## API модулі SLZB-OS
### SLZB - загальні функції
```SLZB.delay(x)``` зупиняє виконання скрипта на X мілісекунд, максимальна затримка 4,294,967,295 мілісекунд або 1193 години. приймає один аргумент типу ```integer```
<br>Приклад: ```SLZB.delay(1000)``` зупинить виконання скрипту на 1 секунду.

```SLZB.millis()``` повертає кількість мілісекунд, що пройшло з моменту старту пристрою.
<br>Приклад: ```SLZB.log("device has been running for " .. SLZB.millis() / 1000 .. "seconds")``` виведе в консоь кількість секунд від старту пристрою.

```SLZB.reboot()``` перезавантажує пристрій.
<br>Приклад: ```SLZB.reboot()``` перезавантажить пристрій негайно!

```SLZB.log(x)``` відправляє текст в консоль відладки SLZB-06.
<br>Приклад: ```SLZB.log("Hello world!")``` виведе в консоль розробника текст ```Hello world!```

```SLZB.freeHeap()``` повертає загальну кількість вільної оперативної пам'яті у системі
<br>Приклад: ```SLZB.log("Free RAM: " .. SLZB.freeHeap())``` виведе в консоль кількість вільної RAM

### ZB - доступ до зігбі чіпу. Використовуйте з обережністю
#### співіснування зігбі сокету та модуля zb
<img src="./images/zigbee access control.png?raw=true" width=650px/>
<br>SLZB-OS використовує паралельне виконання завдань. Це означає, що коли ви хочете отримати до зігбі чіпу ви маєте спочатку "заблокувати" право доступу за допомогою ```ZB.suspend()```
<br>Більшість функцій роблять це автоматично і вам не потрібно хвилюватись але є певний функціонал, що вимагає робити це в ручну.

#### Шо вимагає блокування доступу?
- ```ZB.readBytes()``` ви маєте заблокувати доступ через ```ZB.suspend()``` перед тим як читати байти від зігбі модуля. інакше задача обробки зігбі сокету, що виконується паралельно може забрати відповідь зігбі чіпу собі.

#### доступні функції
```ZB.reboot()``` негайно перезавантажує зігбі чіп.
<br>Приклад: ```ZB.reboot()``` перезавантажить зігбі чіп.

```ZB.flashMode()``` переводить зігбі чіп в режим прошивки. Щоб перевести чіп в нормальний режим перезавантажте його або відправте відповідну команду бутлоадера.
<br>Приклад: ```ZB.flashMode()``` переводить зігбі чіп в режим прошивки.

```ZB.routerPairMode()``` запускає пошук мережі для спарювання якщо зігбі чіп прошито як роутер.
<br>Приклад: ```ZB.routerPairMode()``` запускає пошук мережі для спарювання якщо зігбі чіп прошито як роутер.

```zb.writeBytes(x)``` напряму відправляє до зігбі чіпу байти. Приймає один аргумент типу ```bytes``` і повертає ```integer``` з кількістю відправлених байт.
<br>Приклад: ```ZB.writeBytes(bytes("FE00210120"))``` відправляє до зігбі чіпу пінг-пакет.

```ZB.readBytes()``` читає байти від зігбі чіпу. повертає ```bytes```. Перед використанням цього зупиніть обробку зігбі сокету за допомогою ```ZB.suspend(true)``` інакше відповідь зігбі чіпу може забрати задача обробки сокету
<br>Приклад: ```ZB.readBytes()```.

```ZB.availableBytes()``` повертає кількість байт досупних до читання від зігбі чіпу. повертає ```integer```.
<br>Приклад: ```ZB.availableBytes()```.

```ZB.getZbClients()``` повертає кількість клієнтів підключених до зігбі сокету. повертає ```integer```.
<br>Приклад: ```ZB.getZbClients()```.

```ZB.suspend(x)``` зупиняє або відновлює обробку зігбі сокету. приймає один аргумент типу ```boolean```
<br>Приклад: ```ZB.suspend(true) SLZB.delay(5000) ZB.suspend(false)```. зупиняє обробку зігбі сокету на 5 секунд

### FS - доступ до файлової системи. Використовуйте з обережністю
```FS.exists(x)``` перевіряє чи існує вказаний файл. Повертає ```boolean```
<br>Приклад: ```FS.exists("/be/test.be")```. Поверне ```true``` якщо скрипт ```/be/test.be``` існує

```FS.open(filename, mode)``` нативна функція для роботи з файлами. [Документація](https://berry.readthedocs.io/en/latest/source/en/Chapter-7.html?highlight=open#open-function)
<br>Приклад: перевірте приклад [get_file_size.be](https://github.com/smlight-tech/slzb-os-scripts/blob/main/examlpes/basic/get_file_size.be)